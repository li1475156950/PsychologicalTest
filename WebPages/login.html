
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>京师博仁心理测评档案管理系统</title>
    <!-- BOOTSTRAP STYLES-->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONTAWESOME STYLES-->
    <link href="CSS/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLES-->
    <link href="assets/css/custom.css" rel="stylesheet" />
    <!-- GOOGLE FONTS-->
    <!--<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />-->
    <!-- BOOTSTRAP bootstrapValidator-->
    <link href="css/bootstrapValidator.min.css" rel="stylesheet" />
    <!-- GOOGLE LAYER-->
    <link href="assets/skin/layer.css" rel="stylesheet" />
    <link rel="shortcut icon" href="favicon.ico" />
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #container {
            position: absolute;
            height: 100%;
            width: 100%;
        }

        #output {
            width: 100%;
            height: 100%;
        }

        .color {
            width: 120px;
            height: 20px;
            margin: 0 auto;
            position: fixed;
            left: 50%;
            margin-left: -60px;
            bottom: 20px;
        }

            .color li {
                float: left;
                margin: 0 5px;
                width: 20px;
                height: 20px;
                background: #ccc;
                box-shadow: 0 0 4px #FFF;
                list-style: none;
                cursor: pointer;
            }

                .color li:nth-child(1) {
                    background: #002c4a;
                }

                .color li:nth-child(2) {
                    background: #35ac03;
                }

                .color li:nth-child(3) {
                    background: #ac0908;
                }

                .color li:nth-child(4) {
                    background: #18bbff;
                }
    </style>
    <script src="assets/js/login/jquery.js"></script>
    <script src="js/vector.js"></script>
    <script>
        $(function () {
            // 初始化 传入dom id
            var victor = new Victor("container", "output");
            var theme = [
                    ["#002c4a", "#005584"],
                    ["#35ac03", "#3f4303"],
                    ["#ac0908", "#cd5726"],
                    ["#18bbff", "#00486b"]
            ]
            $(".color li").each(function (index, val) {
                var color = theme[index];
                $(this).mouseover(function () {
                    victor(color).set();
                })
            });
        });
    </script>
</head>
<body>
    <div id="container">
        <div id="output">

        </div>
    </div>

    <div class="container">


        <div class="row text-center ">
            <div class="col-md-12" style="margin-top:8%;">


                <h2>
                    <img src="Img/logo_boren.png" style="width:100px;height:100px;" />
                    <img src="Img/login_logo.png" style="width:320px;" />
                </h2>
                <br />
            </div>
        </div>
        <div class="row ">

            <div class="col-md-4 col-md-offset-4 col-sm-6 col-sm-offset-3 col-xs-10 col-xs-offset-1  login-box">
                <div class="panel panel-default" style="background-color:RGB(246,246,246)">

                    <div class="panel-body">
                        <div class="row" style="margin-top:10px; text-align:center;">
                            <span style="color: RGB(58,145,208); font-family: LiSu; font-size: 30px; ">欢迎登录</span>

                        </div>

                        <form role="form" id="loginForm" method="post">
                            <br />
                            <div class="row">
                                <div class="col-md-12 col-md-12 col-sm-12">
                                    <div class="form-group" style="text-align:center;">
                                        <div class="input-group" style="text-align:center;">
                                            <span class="input-group-addon"><i class="fa fa-user"></i></span>
                                            <input type="text" id="loginName" name="loginName" class="form-control" style="font-weight: bold;" placeholder="用户名" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-md-12 col-sm-12">
                                    <div class="form-group" style="text-align:center;">
                                        <div class="form-group">

                                            <div class="input-group" style="text-align: center; ">
                                                <span class="input-group-addon"><i class="fa fa-lock"></i></span>
                                                <input type="password" id="loginPwd" name="loginPwd" class="form-control" style="font-weight: bold;" placeholder="用户密码" />
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-md-12 col-sm-12">
                                    <div class="form-group" style="text-align:center;">
                                        <div class="form-group">

                                            <div class="input-group" style="text-align: center; ">
                                                <span class="input-group-addon"><i class="fa fa-lock"></i></span>
                                                <input type="text" id="EnameA" name="Ename" class="form-control" style="font-weight: bold;" placeholder="企业名称" />
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-inline" style="margin-left:15px;">
                                    <input type="checkbox" id="rememberPwd" /> 记住我
                                </label>
                                <span class="pull-right">
                                    <!--<a href="javascript:void(0)" onclick="ShowRegisterPage()">立即注册 </a>-->
                                </span>
                            </div>
                            <div class="form-group form-actions" style="text-align:center;">
                                <!--<div class="col-lg-4 col-lg-offset-4  col-sm-6 col-sm-offset-3 col-xs-8 col-xs-offset-2">-->

                                <button type="submit" id="submitas" class="btn btn-primary" style="width:85%;"><span style="font-weight: bold;">登&nbsp;录</span></button>
                                <!--<button type="submit" class="btn btn-sm btn-info"><span class="glyphicon glyphicon-off"></span>登录</button>-->
                                <!--</div>-->
                            </div>
                        </form>
                    </div>

                </div>
            </div>
            <div class="col-md-4 col-md-offset-4 col-sm-6 col-sm-offset-3 col-xs-10 col-xs-offset-1" style="display:none;">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <strong>  新用户注册信息 </strong>
                    </div>
                    <div class="panel-body">
                        <form role="form">
                            <br>
                            <div class="form-group input-group">
                                <span class="input-group-addon"><i class="fa fa-circle-o-notch"></i></span>
                                <input type="text" class="form-control" id="regName" placeholder="登录名">
                            </div>
                            <div class="form-group input-group">
                                <span class="input-group-addon"><i class="fa fa-lock"></i></span>
                                <input type="password" id="regPwd" class="form-control" placeholder="登陆密码">
                            </div>
                            <div class="form-group input-group">
                                <span class="input-group-addon"><i class="fa fa-key"></i></span>
                                <input type="text" class="form-control" id="regRepPwd" placeholder="确认密码">
                            </div>
                            <div class="form-group input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <input type="text" class="form-control" placeholder="姓名">
                            </div>

                            <div class="form-group input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <select id="gender" name="gender" class="form-control">
                                    <option selected="selected">请选择性别</option>
                                    <option>男</option>
                                    <option>女</option>
                                </select>
                            </div>
                            <div class="form-group input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <input type="text" id="bornDate" name="bornDate" class="form-control" placeholder="出生日期" />
                            </div>

                            <div class="form-group input-group">
                                <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                <input placeholder="所属部门" name="department" id="department" />

                            </div>
                            <div class="form-group input-group">
                                <span class="input-group-addon">@</span>
                                <input type="text" class="form-control" id="department" placeholder="邮箱" />
                            </div>



                            <div class="form-group input-group">
                                <div class="row">
                                    <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5"><input name="verifyCode" class="form-control" placeholder="请输入验证码" /></div>
                                    <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3"><span id="imgcontainer"></span></div>
                                    <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4"><a href="javascript:void(0)" onclick="ChangeVerifyCode()"><small>看不清，换一张</small></a></div>

                                </div>


                            </div>

                            <a href="index.html" class="btn btn-success ">Register Me</a>
                            <hr>
                            Already Registered ?  <a href="login.html">Login here</a>
                        </form>
                    </div>

                </div>
            </div>


        </div>




    </div>

    <ul class="color">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>

    <!-- SCRIPTS -AT THE BOTOM TO REDUCE THE LOAD TIME-->
    <!-- JQUERY SCRIPTS -->
    <script src="assets/js/jquery-1.10.2.js"></script>
    <!-- BOOTSTRAP SCRIPTS -->
    <script src="assets/js/bootstrap.min.js"></script>
    <!-- METISMENU SCRIPTS -->
    <script src="assets/js/jquery.metisMenu.js"></script>
    <!-- CUSTOM SCRIPTS -->
    <script src="assets/js/custom.js"></script>
    <!-- LAYER SCRIPTS -->
    <script src="js/layer.js"></script>
    <script src="js/bootstrapValidator.min.js"></script>
    <script src="JS/bootstrap-datepicker.js"></script>
    <script src="JS/ligerComboBox/ligerTree.js"></script>
    <script src="JS/ligerComboBox/ligerComboBox.js"></script>


    <script type="text/javascript">
        //样式
        Yang();
        function Yang() {
            var lock = false;
            if (/AppleWebKit.*Mobile/i.test(navigator.userAgent) || (/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent))) {

                if (window.location.href.indexOf("?mobile") < 0) {

                    try {

                        if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {

                            // 判断访问环境是 Android|webOS|iPhone|iPod|BlackBerry 则加载以下样式

                            setActiveStyleSheet("../../CSS/mobile.css");

                        }

                        else if (/iPad/i.test(navigator.userAgent)) {

                            // 判断访问环境是 iPad 则加载以下样式

                            setActiveStyleSheet("../../CSS/pc.css");

                        }

                        else {

                            // 判断访问环境是 其他移动设备 则加载以下样式

                            setActiveStyleSheet("../../CSS/pc.css");

                        }

                    }

                    catch (e) { }

                }

            }

            else {
                // 如果以上都不是，则加载以下样式
                setActiveStyleSheet("../../CSS/pc.css");

            }
            $("#regName").focus(function () {

                if ($("#regName").val() == "") {
                    $("#loginNameRule").show();
                }
            })
            jQuery(function ($) {

                txtValue = $("#loginName").val();

                ////////    给txtbox绑定键盘事件
                $("#loginName").bind("keydown", function () {
                    var currentValue = $(this).val();
                    $.ajax({
                        url: "Ajax/LoginAndRegister.ashx?operationType=ClearPwd",
                        type: "GET",
                        data: { loginName: currentValue },
                        dataType: "json",
                        success: function (result) {
                            if (result.State) {
                                $("#loginPwd").val(result.Data);
                            }
                            else {
                                $("#loginPwd").val("");
                            }
                        }
                    })

                });

            });
            function setActiveStyleSheet(filename) {
                var html = "<link href='" + filename + "' rel='stylesheet'>";
                $("head").append(html);
            }
            GetCookieValue();
            function GetCookieValue() {
                $.ajax({
                    url: "FunctionModular/LoginAndRegister/Ajax/LoginAndRegister.ashx?operationType=GetCookie",
                    dataType: "json",
                    success: function (data) {
                        if (data != undefined) {
                            if (data["loginNameCookie"] != "@@") {
                                $("#loginName").val(data["loginNameCookie"]);
                                $("#loginPwd").val(data["loginPwdCookie"]);
                                $("#rememberPwd")[0].checked = true;
                            }
                            else {
                                data["loginNameCookie"] == "";
                                document.getElementById("loginName").value = "";
                                $("#loginName").val("");
                                $("#loginPwd").val("");
                            }
                        }

                    }
                })
            }
            function ShowRegisterPage() {
                $(".register-box").show();
                $(".box").css("height", "1150px");

                $(".login-box").hide();
            }
            function ShowLoginPage() {
                $(".register-box").hide();
                $(".box").css("height", "100%");

                $(".login-box").show();
            }
        }

        //登陆
        login();
        function login() {
            $('#loginForm').bootstrapValidator({
                message: '表单验证失败.',
                feedbackIcons: {
                    //valid: 'glyphicon glyphicon-ok',
                    //invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    loginName: {
                        message: '用户名验证失败',
                        validators: {
                            notEmpty: {
                                message: '用户名不能为空'
                            },
                            //stringLength: {
                            //    min: 2,
                            //    max: 20,
                            //    message: '用户名长度必须介于2到20之间'
                            //},
                            threshold: 2,
                        }
                    }, loginPwd: {
                        message: '密码格式不正确',
                        validators: {
                            notEmpty: {
                                message: '用户密码不能为空'
                            },
                            //stringLength: {
                            //    min: 6,
                            //    max: 30,
                            //    message: '用户名密码不能小于6位，且不能大于30位'
                            //},
                        }

                    },
                    Ename: {
                        message: '企业账号验证失败',
                        validators: {
                            notEmpty: {
                                message: '企业账号不能为空'
                            },

                        }
                    },
                }
            }).on('success.form.bv', function (e) {
                e.preventDefault();
                $.ajax({
                    url: "FunctionModular/LoginAndRegister/Ajax/LoginAndRegister.ashx?operationType=login",
                    type: "GET",
                    data: {
                        loginName: $("#loginName").val(),
                        pwd: $("#loginPwd").val(),
                        rememberPwd: $("#rememberPwd")[0].checked,
                        ENameS: $("#EnameA").val()
                    },
                    dataType: "text",
                    success: function (data) {
                        if (data == 1) {
                            window.location.href = "Index.aspx";
                        } else if (data == 3) {
                            layer.confirm('序列号没有激活是否要激活？', {
                                btn: ['确定', '取消'] //按钮
                            }, function () {
                                //  $("#myModal").modal('show');
                                layer.closeAll("dialog");
                                L_Activation();

                            });

                            //弹框
                        } else if (data == 4) {
                            layer.alert('企业账号错误！', {
                                skin: 'layui-layer-lan', //样式类名
                                closeBtn: 0
                            });
                        } else if (data == 5) {
                            layer.alert('该企业授权已失效！', {
                                skin: 'layui-layer-lan', //样式类名
                                closeBtn: 0
                            });
                        }
                        else {
                            layer.alert('登录失败,用户名或密码错误', {
                                skin: 'layui-layer-lan', //样式类名
                                closeBtn: 0
                            });
                        }
                    }
                })

            })
        }
        //GetUsename();
        //function GetUsename() {

        //    alert('00000000000000000');
        //    $.ajax({
        //        url: "FunctionModular/LoginAndRegister/Ajax/LoginAndRegister.ashx?operationType=CheckUseName",
        //        type: "GET",
        //        data: {},
        //        dataType: "text",
        //        success: function (data) {
        //            alert('当前登陆的用户名为====>【' + data + '】');
        //            //layer.alert('当前登陆的用户名为====>【' + data + '】', {
        //            //    skin: 'layui-layer-lan', //样式类名
        //            //    closeBtn: 0
        //            //});
        //        }
        //    })

        //}


        function GetNowTime() {
            var nowtime = new Date();
            var year = nowtime.getFullYear();
            var month = (nowtime.getMonth() + 1);
            var day = (nowtime.getDate());
            return year + "-" + month + "-" + day;
        }
        $('#bornDate').datepicker({ format: 'yyyy-mm-dd', weekStart: 1, autoclose: true, todayBtn: 'linked', language: 'cn' });

        $('#bornDate').datepicker('setEndDate', GetNowTime());

        //CreateVerifyCode();
        //function CreateVerifyCode() {
        //    var url = "Ajax/LoginAndRegister.ashx?operationType=GetVerifyCode";
        //    var xhr = new XMLHttpRequest();
        //    xhr.open("get", url, true);
        //    xhr.responseType = "blob";
        //    xhr.onload = function () {
        //        if (this.status == 200) {
        //            var blob = this.response;
        //            var img = document.createElement("img");
        //            img.onload = function (e) {
        //                window.URL.revokeObjectURL(img.src);
        //            };
        //            img.src = window.URL.createObjectURL(blob);
        //            $("#imgcontainer").html(img);

        //        }
        //    }; xhr.send();
        //}
        //function ChangeVerifyCode() {
        //    CreateVerifyCode();
        //}
        //OnLoadTreeComs();
        //function OnLoadTreeComs() {
        //    $("#department").ligerComboBox({
        //        width: 150,
        //        selectBoxWidth: 150,
        //        selectBoxHeight: 150,
        //        valueField: 'id',
        //        textField: 'text',
        //        treeLeafOnly: false,
        //        tree: {
        //            onSuccess: function () {
        //                setTimeout(function () {
        //                    var manager = $(".l-tree").ligerGetTreeManager();
        //                }, 100);
        //            },
        //            onBeforeSelect: function (node) {
        //                $("#department").attr("data-id", node.data['id']);
        //            },
        //            url: '/FunctionModular/BasicSetting/Ajax/DepartmentMain.ashx?Remark=OnLoadDep&rnd=' + Math.random(),
        //            usericon: 'd_icon',
        //            idFieldName: 'id',
        //            checkbox: false
        //        }
        //    });
        //}

        // 查询按s钮绑定回车键
        $(document).keydown(function (event) {
            if (event.keyCode == 13) {
                $("#submitas").click();
            }
        });
        function YZXLH() {
            $.ajax({
                url: "FunctionModular/LoginAndRegister/Ajax/LoginAndRegister.ashx?operationType=YZXLH",
                type: "GET",
                data: { xlhname: $("#xlhname").val(), password: $("#password").val() },
                dataType: "text",
                success: function (data) {
                    if (data == 1) {
                        window.location.href = "Index.aspx?type=1";
                    } else if (data == 2) {
                        layer.alert('序列号不正确', {
                            skin: 'layui-layer-lan', //样式类名
                            closeBtn: 0
                        });
                        return;
                    }
                        //else if (data == 3) {
                        //    layer.alert('还没有激活', {
                        //        skin: 'layui-layer-lan', //样式类名
                        //        closeBtn: 0
                        //    });
                        //    return;
                        //}
                    else {
                        layer.alert('激活失败！', {
                            skin: 'layui-layer-lan', //样式类名
                            closeBtn: 0
                        });
                    }
                }
            })

        }



        function L_Activation() {

            layer.open({
                type: 1
                , title: false //不显示标题栏
                , closeBtn: false
                , area: '300px;'
                , shade: 0.8
                , id: 'LAY_layuipro' //设定一个id，防止重复弹出
                , btn: ['保存', '取消']
                , moveType: 1 //拖拽模式，0或者1
                , content: ' <div style="padding: 50px; line-height: 22px; background-color:#ffffff; font-weight: 300;"><input type="text" id="xlhname" name="xlhname" style="width: 100%;" placeholder="输入序列号" /></div><div style="padding: 0px 50px 50px 50px; line-height: 22px; background-color:#ffffff; font-weight: 300;"><input id="password" type="password" name="password" style="width: 100%;" placeholder="请输入激活码" /></div>'
                , success: function (layero) {
                    var btn = layero.find('.layui-layer-btn');
                    btn.css('text-align', 'center');
                    btn.find('.layui-layer-btn0').attr("onclick", "YZXLH()");
                }
            });
        }
    </script>


</body>

</html>
